@model Portal_MovilEsales.Services.AdministradorServices.ViewModels.DetalleReclamo.ReclamoIndividual
<div class="row">
    <div class="col-sm-12">
        <div class="card card-container">
            <div class="card-body">
                <div class="row">
                    <div class="card-title">
                        <h1 style="font-size: 18px !important">Reclamo en progreso</h1>
                    </div>
                </div>

                <a data-bs-toggle="collapse" href="#collapseDatosOriginales" role="button" aria-expanded="true" aria-controls="collapseDatosOriginales">
                    <div class="collapsible-tabs">
                        <div class="label">
                            <div class="label-color-wrapper">
                                <div class="label-color"><div class="text">Datos Originales</div></div>
                            </div>
                            <div class="chevron">
                                <svg width="23" height="14" viewBox="0 0 23 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g id="&#240;&#159;&#166;&#134; icon &#34;chevron down&#34;">
                                        <path id="Vector" d="M1.5 2L11.5 12L21.5 2" stroke="#D7D2CB" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>

                <div class="row" id="collapseDatosOriginales">
                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Motivo</label>
                        <p>@Model.motivo</p>
                    </div>

                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Factura</label>
                        <p>@Model.factura</p>
                    </div>

                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Producto</label>
                        <p>@Model.producto</p>

                    </div>
                </div>

                <div class="row" id="collapseDatosOriginales">
                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Referencia</label>
                        <p>@Model.referencia</p>

                    </div>

                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Asunto</label>
                        <p>@Model.asunto</p>

                    </div>

                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Observaciones</label>
                        <p>@Model.observacionesDatosOriginales</p>
                    </div>
                </div>

                <div class="row" id="collapseDatosOriginales">
                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">
                            Fotografía del Material
                            <button class="orange-rounded-button ms-1" onclick="verFotografia()">
                                Ver
                            </button>
                        </label>
                    </div>

                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">
                            Copia de Factura
                            <button class="orange-rounded-button ms-1" onclick="verFactura()">
                                Ver
                            </button>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*-------------------------------------------------------------------------------*@
    <div class="col-sm-12">
        <div class="card card-container">
            <div class="card-body">
                <a data-bs-toggle="collapse" href="#collapseDatosComplementarios2" role="button" aria-expanded="true" aria-controls="collapseDatosComplementarios2">
                    <div class="collapsible-tabs">
                        <div class="label">
                            <div class="label-color-wrapper">
                                <div class="label-color"><div class="text">Datos Complementarios</div></div>
                            </div>
                            <div class="chevron">
                                <svg width="23" height="14" viewBox="0 0 23 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g id="&#240;&#159;&#166;&#134; icon &#34;chevron down&#34;">
                                        <path id="Vector" d="M1.5 2L11.5 12L21.5 2" stroke="#D7D2CB" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>

                <div class="collapse show mb-4" id="collapseDatosComplementarios2">
                    <div class="row" id="collapseDatosOriginales2">
                        <div class="col-sm-12 col-md-6">
                            <label class="card-subtitle">Departamento</label>
                            <p>@Model.departamento</p>
                        </div>

                        <div class="col-sm-12 col-md-6">
                            <label class="card-subtitle">Días para resolver</label>
                            <p>@Model.diasParaResolver</p>
                        </div>
                    </div>
                    <div class="row" id="collapseDatosOriginales2">
                        <div class="col-sm-12 col-md-6">
                            <label class="card-subtitle">Correos a notificar (Internamente)</label>
                            <p>@Model.correosANotificar</p>
                        </div>

                        <div class="col-sm-12 col-md-6">
                            <label class="card-subtitle">Estado</label>
                            <p>@Model.estado</p>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <label class="card-subtitle">Observaciones</label>
                        <p>@Model.observacionesDatosComplementarios</p>
                    </div>

                </div>
            </div>
        </div>
    </div>


    @*-------------------------------------------------------------------------------*@
    <div class="col-sm-12">
        <div class="card card-container">
            <div class="card-body">


                <div class="col-sm-12 ">
                    <div class="form-group">
                        <label class="label-datepicker" for="estadoAccion">Estado </label>
                        <select class="form-control datepicker" id="estadoAccion">
                            @foreach (var item in Model.listaEstados)
                            {
                                <option value=@item.estado selected>@item.estado</option>
                            }
                        </select>
                    </div>
                </div>

                <a data-bs-toggle="collapse" href="#collapseNuevaAccion" role="button" aria-expanded="true" aria-controls="collapseNuevaAccion">
                    <div class="collapsible-tabs">
                        <div class="label">
                            <div class="label-color-wrapper">
                                <div class="label-color"><div class="text">Nueva Acción</div></div>
                            </div>
                            <div class="chevron">
                                <svg width="23" height="14" viewBox="0 0 23 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g id="&#240;&#159;&#166;&#134; icon &#34;chevron down&#34;">
                                        <path id="Vector" d="M1.5 2L11.5 12L21.5 2" stroke="#D7D2CB" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>

                <div class="collapse show mb-4" id="collapseNuevaAccion">
                    <div class="row">
                        <div class="col-12">
                            <label for="accion" class="label-datepicker">Acción</label>
                            <input id="accion" class="form-control input-custom" type="text" />
                        </div>

                        <div class="col-12">
                            <div class="form-group">
                                <label class="label-datepicker" for="observacionesAcciones">Observaciones</label>
                                <textarea id="observacionesAcciones" class="form-control input-custom" rows="4" placeholder="El contenido puede tener de 50 a 250 caracteres."></textarea>
                            </div>
                        </div>

                        <div class="col-12">
                            <label for="archivo" class="label-datepicker">Archivos adjuntos</label>
                            <div class="input-group">
                                <input type="text" id="archivo" class="form-control datepicker" placeholder="Examinar..." readonly>
                                <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('inputFile').click()">
                                    <svg style="margin:5px;" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g id="&#240;&#159;&#166;&#134; icon &#34;search&#34;">
                                            <path id="Vector" d="M9.88894 18.7779C14.7982 18.7779 18.7779 14.7982 18.7779 9.88894C18.7779 4.97971 14.7982 1 9.88894 1C4.97971 1 1 4.97971 1 9.88894C1 14.7982 4.97971 18.7779 9.88894 18.7779Z" stroke="#01ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            <path id="Vector_2" d="M21 21.0013L16.1666 16.168" stroke="#01ADEF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </g>
                                    </svg>
                                </button>
                                <input type="file" id="inputFile" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end pt-3 mb-3">
                    <button class="orange-rounded-button ms-1" data-bs-dismiss="modal" style="background-color: #69A5BD;" onclick="cancelar()">
                        Cancelar
                        <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="01 align center">
                                <path id="Vector" d="M15.293 8.11279L12 11.4058L8.70697 8.11279L7.29297 9.52679L10.586 12.8198L7.29297 16.1128L8.70697 17.5268L12 14.2338L15.293 17.5268L16.707 16.1128L13.414 12.8198L16.707 9.52679L15.293 8.11279Z" fill="white" />
                                <path id="Vector_2" d="M12 0.819824C9.62663 0.819824 7.30655 1.52361 5.33316 2.84219C3.35977 4.16077 1.8217 6.03491 0.913451 8.22762C0.00519943 10.4203 -0.232441 12.8331 0.230582 15.1609C0.693605 17.4887 1.83649 19.6269 3.51472 21.3051C5.19295 22.9833 7.33115 24.1262 9.65892 24.5892C11.9867 25.0523 14.3995 24.8146 16.5922 23.9064C18.7849 22.9981 20.6591 21.4601 21.9776 19.4867C23.2962 17.5133 24 15.1932 24 12.8198C23.9966 9.63828 22.7312 6.58804 20.4815 4.33834C18.2318 2.08865 15.1815 0.823265 12 0.819824V0.819824ZM12 22.8198C10.0222 22.8198 8.08879 22.2333 6.4443 21.1345C4.79981 20.0357 3.51809 18.4739 2.76121 16.6467C2.00433 14.8194 1.8063 12.8087 2.19215 10.8689C2.578 8.92911 3.53041 7.14728 4.92894 5.74876C6.32746 4.35023 8.10929 3.39782 10.0491 3.01197C11.9889 2.62612 13.9996 2.82415 15.8268 3.58103C17.6541 4.33791 19.2159 5.61963 20.3147 7.26412C21.4135 8.90861 22 10.842 22 12.8198C21.9971 15.4711 20.9426 18.0129 19.0679 19.8877C17.1931 21.7624 14.6513 22.8169 12 22.8198Z" fill="white" />
                            </g>
                        </svg>
                    </button>

                    <button class="orange-rounded-button ms-1" onclick="grabarAccion('@Url.Action("Acciones","Administrador")')">
                        Guardar
                        <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="01 align center">
                                <path id="Vector" d="M19 0.819824H3C2.20435 0.819824 1.44129 1.13589 0.87868 1.6985C0.31607 2.26111 0 3.02417 0 3.81982L0 24.8198H24V5.81982L19 0.819824ZM7 2.81982H17V6.81982H7V2.81982ZM22 22.8198H2V3.81982C2 3.55461 2.10536 3.30025 2.29289 3.11272C2.48043 2.92518 2.73478 2.81982 3 2.81982H5V8.81982H19V3.64782L22 6.64782V22.8198Z" fill="white" />
                                <path id="Vector_2" d="M12 10.8196C11.2089 10.8196 10.4355 11.0542 9.77772 11.4937C9.11993 11.9332 8.60723 12.5579 8.30448 13.2888C8.00173 14.0198 7.92252 14.824 8.07686 15.5999C8.2312 16.3759 8.61216 17.0886 9.17157 17.648C9.73098 18.2074 10.4437 18.5884 11.2196 18.7427C11.9956 18.8971 12.7998 18.8178 13.5307 18.5151C14.2616 18.2123 14.8864 17.6997 15.3259 17.0419C15.7654 16.3841 16 15.6107 16 14.8196C16 13.7587 15.5786 12.7413 14.8284 11.9912C14.0783 11.241 13.0609 10.8196 12 10.8196ZM12 16.8196C11.6044 16.8196 11.2178 16.7023 10.8889 16.4825C10.56 16.2628 10.3036 15.9504 10.1522 15.5849C10.0009 15.2195 9.96126 14.8174 10.0384 14.4294C10.1156 14.0414 10.3061 13.6851 10.5858 13.4054C10.8655 13.1257 11.2219 12.9352 11.6098 12.858C11.9978 12.7808 12.3999 12.8204 12.7654 12.9718C13.1308 13.1232 13.4432 13.3795 13.6629 13.7084C13.8827 14.0373 14 14.424 14 14.8196C14 15.35 13.7893 15.8587 13.4142 16.2338C13.0391 16.6089 12.5304 16.8196 12 16.8196Z" fill="white" />
                            </g>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    @*-------------------------------------------------------------------------------*@
    <div class="col-sm-12">
        <div class="card card-container">
            <div class="card-body">
                <div id="listaAcciones" style="display: block;">
                    <a data-bs-toggle="collapse" href="#collapseAcciones" role="button" aria-expanded="true" aria-controls="collapseAcciones">
                        <div class="collapsible-tabs">
                            <div class="label">
                                <div class="label-color-wrapper">
                                    <div class="label-color"><div class="text">Nueva Acción</div></div>
                                </div>
                                <div class="chevron">
                                    <svg width="23" height="14" viewBox="0 0 23 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g id="&#240;&#159;&#166;&#134; icon &#34;chevron down&#34;">
                                            <path id="Vector" d="M1.5 2L11.5 12L21.5 2" stroke="#D7D2CB" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </a>
                    <div class="collapse show mb-4" id="collapseAcciones">
                        <div class="row">
                            <div class="col-12 ">
                                <div class="form-group">
                                    <label class="label-datepicker" for="listaAccionesRealizadas">Acciones Realizadas:</label>
                                    @foreach (var accion in Model.listaAcciones)
                                    {
                                        <label id="listaAccionesRealizadas" class="form-control">
                                            @($"{accion.fechaIngreso}   -   {accion.responsable}")<br />
                                            @($"{accion.observaciones}")
                                        </label>

                                        <br />
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function verFotografia() {
        var fotografia = "@Model.fotografiaMaterial";
        window.open(fotografia, '_blank');
    }
    function verFactura() {
        var factura = "@Model.copiaFactura";
        window.open(factura, '_blank');
    }

    const grabarAccion = (url) => {
        var codigoReclamo = @Model.codigoReclamo;
        var estado = document.getElementById("estadoAccion").value;
        var accion = document.getElementById("accion").value;
        var observaciones = document.getElementById("observacionesAcciones").value;
        //var archivoBase64 = document.getElementById("archivo").value;
        var archivoBase64 = "Prueba envio";
        url = `${url}?codigoReclamo=${codigoReclamo}&estado=${estado}&accion=${accion}&observaciones=${observaciones}&archivoBase64=${archivoBase64}`;
        fetch(url)
            .then(response => response.text())
            .then(html => {
                showAlert("Proceso exitoso", "", "success");
                setTimeout(() => {
                    window.location.href = `/Administrador`;
                }, 10000);
            })
            .catch(error => console.error('Error al cargar información:', error));
    }

    const showAlert = (title, message, type) => {
        Swal.fire({
            title: title,
            text: message,
            showDenyButton: false,
            showCancelButton: false,
            confirmButtonText: "Aceptar",
        }).then((result) => {
            if (result.isConfirmed) {
                console.log("se presiono")
            }
        });
    }

    function cancelar() {
        window.location.href = `/Administrador/ReclamoIndividual?codigoReclamo=${codigoReclamo}`;
    }

</script>
